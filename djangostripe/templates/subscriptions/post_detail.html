{% load static %} {% include "subscriptions/navbar.html" %}

<style>
  /* Modern Dark Palette */
  :root {
    --velvet: #5a0f2f;
    --noir: #0e0e0f;
    --gold: #d1b98e;
    --rose: #cba6a0;
    --pearl: #f4f2ef;
    --card-bg: #1a0f17;
  }

  body {
    background-color: var(--noir);
    color: var(--pearl);
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  }

  .story-container {
    max-width: 1300px;
    margin: auto;
    padding: 3rem 1rem;
  }

  .story-title {
    font-weight: 700;
    font-size: 2.5rem;
    margin-bottom: 2rem;
    text-align: center;
    color: var(--pearl);
  }

  .story-card {
    background-color: var(--card-bg);
    color: var(--pearl);
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .story-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.6);
  }

  .story-meta {
    color: var(--rose);
    font-size: 0.9rem;
    margin-top: 1.5rem;
    text-align: right;
  }

  .btn-subscribe {
    background: linear-gradient(135deg, var(--gold), var(--rose));
    color: var(--noir);
    font-weight: 600;
    padding: 0.8rem 2rem;
    border: none;
    border-radius: 50px;
    transition: all 0.3s ease;
  }

  .btn-subscribe:hover {
    background: linear-gradient(135deg, var(--rose), var(--gold));
    color: var(--pearl);
    transform: scale(1.05);
  }

  .pagination-btn {
    background: var(--velvet);
    color: var(--gold);
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    transition: all 0.3s ease;
  }

  .pagination-btn:hover {
    background: var(--gold);
    color: var(--noir);
  }

  .story-nav {
    display: flex;
    justify-content: space-between;
    margin-top: 2rem;
  }

  a {
    text-decoration: none;
  }

  .no-select {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
</style>

{% block content %}
<div class="no-select">
  <div class="story-container">
    <h1 class="story-title">{{ post.title }}</h1>

    {% if subscription and subscription.status == "active" %}

    <!-- FULL CONTENT FOR SUBSCRIBER -->
    <div class="story-card mb-5">
      <article class="fs-5">
        <p>{{ page_obj.object_list.0|linebreaks }}</p>
        <p class="story-meta">Created on: {{ post.created_at }}</p>
      </article>

      <!-- Pagination -->
      <div class="d-flex justify-content-between mt-4">
        {% if page_obj.has_previous %}
        <a
          href="?page={{ page_obj.previous_page_number }}"
          class="pagination-btn"
          >← Previous Page</a
        >
        {% else %}
        <span></span>
        {% endif %}

        <span class="text-pearl">
          Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" class="pagination-btn"
          >Next Page →</a
        >
        {% endif %}
      </div>
    </div>

    <!-- Next/Previous Story navigation -->
    <div class="story-nav">
      {% if post.get_previous_by_created_at %}
      <a
        href="{% url 'post_detail' post.get_previous_by_created_at.slug %}"
        class="btn-subscribe"
        >← Previous Story</a
      >
      {% else %}
      <span></span>
      {% endif %} {% if post.get_next_by_created_at %}
      <a
        href="{% url 'post_detail' post.get_next_by_created_at.slug %}"
        class="btn-subscribe"
        >Next Story →</a
      >
      {% endif %}
    </div>

    {% else %}

    <!-- TEASER + PAYWALL -->
    <div class="story-card mb-5">
      <article class="fs-5">
        <p>{{ post.content|truncatewords:80|linebreaks|safe }}</p>

        <div class="text-center mt-4">
          <a href="{% url 'subscriptions-home' %}" class="btn-subscribe">
            Subscribe to read the full story
          </a>
        </div>
      </article>
    </div>

    {% endif %}
  </div>
</div>

<footer class="text-center mt-5 py-4">
  &copy; <span id="year"></span> Mile High Diaries. All rights reserved.
</footer>

<script>
  document.addEventListener("contextmenu", (event) => event.preventDefault());
</script>
<script>
  document.addEventListener("copy", (e) => e.preventDefault());
  document.addEventListener("cut", (e) => e.preventDefault());
  document.addEventListener("paste", (e) => e.preventDefault());
</script>
<script>
document.addEventListener("keydown", function (e) {
    if (e.ctrlKey && ["c", "u", "s", "x", "a"].includes(e.key.toLowerCase())) {
        e.preventDefault();
    }
    if (e.key === "PrintScreen") {
        e.preventDefault();
    }
});
</script>

<script>
  document.getElementById("year").textContent = new Date().getFullYear();
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "{{ post.title }}",
  "description": "{{ post.excerpt|truncatewords:30 }}",
  "author": { "@type": "Person", "name": "Mile High Diaries" },
  "image": [
      "{{ post.featured_image.url }}"
  ],
  "datePublished": "{{ post.created_at|date:"Y-m-d" }}"
}
</script>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

{% endblock %}
